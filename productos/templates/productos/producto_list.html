{% extends 'productos/base_producto.html' %}
{% load static %}

{% block title %}Lista de Productos 췅 Tienda Plus{% endblock %}

{% block producto_content %}
<style>
  .producto-list-hero {
    background: linear-gradient(135deg, #0d6efd, #6610f2);
    color: #fff;
    border-radius: 1rem;
    box-shadow: 0 10px 20px rgba(0,0,0,.15);
  }
  .table-modern {
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 0 12px 28px rgba(0,0,0,.12);
  }
  .table-modern thead {
    background: #212529;
    color: #fff;
  }
  .table-modern tbody tr {
    transition: background-color .15s ease;
  }
  .table-modern tbody tr:hover {
    background-color: rgba(13,110,253,.06);
  }
  .badge-soft {
    border-radius: .5rem;
    font-size: .85rem;
    padding: .35em .65em;
  }
  .producto-thumb {
    width: 80px;
    height: 60px;
    object-fit: cover;
    border-radius: .5rem;
    box-shadow: 0 6px 12px rgba(0,0,0,.08);
  }
  .empty-state {
    border-radius: 1rem;
    box-shadow: 0 10px 20px rgba(0,0,0,.08);
  }
  .pagination .page-link {
    border-radius: .5rem;
    margin: 0 .25rem;
  }
</style>

<div class="container py-4">

  <!-- Hero superior -->
  <div class="producto-list-hero p-4 p-md-5 mb-4 text-center">
    <h1 class="h3 mb-2"><i class="bi bi-box-seam me-2"></i>Lista de productos</h1>
    <p class="mb-0 opacity-75">Administr치 y explor치 todos los productos disponibles en tu cat치logo.</p>
  </div>

  <!-- Bot칩n agregar producto (solo staff) -->
  {% if user.is_staff %}
    <div class="mb-4 text-center">
      <a href="{% url 'productos:producto_create' %}" class="btn btn-primary btn-icon shadow-sm">
        <i class="bi bi-plus-circle-fill me-1"></i>Nuevo producto
      </a>
    </div>
  {% endif %}

  <!-- Tabla de productos -->
  <div class="table-responsive">
    <table class="table table-modern align-middle text-center">
      <thead>
        <tr>
          <th>Portada</th>
          <th>Nombre</th>
          <th>Categor칤a</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for producto in productos %}
          <tr>
            <td>
              <a href="{% url 'productos:producto_detail' producto.id %}">
                {% if producto.portada and producto.portada.url %}
                  <img src="{{ producto.portada.url }}" alt="{{ producto.nombre }}" class="producto-thumb">
                {% else %}
                  <img src="{% static 'img/default_thumb.jpg' %}" alt="Sin imagen" class="producto-thumb">
                {% endif %}
              </a>
            </td>
            <td>
              <a href="{% url 'productos:producto_detail' producto.id %}" class="fw-bold text-decoration-none text-dark">
                {{ producto.nombre }}
              </a>
            </td>
            <td>
              {% if producto.categoria %}
                <i class="bi bi-folder-fill me-1"></i>{{ producto.categoria.nombre }}
              {% else %}
                <span class="text-muted">Sin categor칤a</span>
              {% endif %}
            </td>
            <td><strong><i class="bi bi-currency-dollar me-1"></i>{{ producto.precio|floatformat:2 }}</strong></td>
            <td>
              {% if producto.stock == 0 %}
                <span class="badge bg-danger badge-soft"><i class="bi bi-x-circle me-1"></i>Agotado</span>
              {% elif producto.stock < 5 %}
                <span class="badge bg-warning text-dark badge-soft"><i class="bi bi-exclamation-triangle me-1"></i>Stock bajo ({{ producto.stock }})</span>
              {% else %}
                <span class="badge bg-success badge-soft"><i class="bi bi-check-circle me-1"></i>Disponible ({{ producto.stock }})</span>
              {% endif %}
            </td>
            <td>
              <div class="d-flex flex-wrap justify-content-center gap-2">
                <a href="{% url 'productos:producto_detail' producto.id %}" class="btn btn-sm btn-info btn-icon">
                  <i class="bi bi-search me-1"></i>Ver
                </a>
                {% if user.is_staff %}
                  <a href="{% url 'productos:producto_update' producto.id %}" class="btn btn-sm btn-warning btn-icon">
                    <i class="bi bi-pencil-fill me-1"></i>Editar
                  </a>
                  <a href="{% url 'productos:producto_delete' producto.id %}" class="btn btn-sm btn-danger btn-icon">
                    <i class="bi bi-trash-fill me-1"></i>Eliminar
                  </a>
                {% else %}
                  {% if producto.stock > 0 %}
                    <form method="post" action="{% url 'carrito:carrito_add' producto.id %}" class="d-inline">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-primary btn-icon">
                        <i class="bi bi-cart-plus me-1"></i>Agregar
                      </button>
                    </form>
                  {% else %}
                    <span class="text-muted">No disponible</span>
                  {% endif %}
                {% endif %}
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted py-5">
              <div class="display-6 mb-3">游닔</div>
              <h5>No se encontraron productos</h5>
              {% if user.is_staff %}
                <p class="text-secondary">Agreg치 un nuevo producto desde el bot칩n de arriba.</p>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Paginaci칩n -->
  {% if is_paginated %}
    <nav aria-label="Paginaci칩n de productos">
      <ul class="pagination justify-content-center mt-4">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
              <i class="bi bi-arrow-left me-1"></i>Anterior
            </a>
          </li>
        {% endif %}
        <li class="page-item active">
          <span class="page-link">{{ page_obj.number }}</span>
        </li>
        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">
              Siguiente<i class="bi bi-arrow-right ms-1"></i>
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}

</div>
{% endblock %}
