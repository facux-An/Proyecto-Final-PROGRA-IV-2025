{% extends 'productos/base_producto.html' %}
{% load static %}

{% block producto_content %}
<h2 class="mb-4">üì¶ Lista de productos</h2>

<!-- Formulario de filtros -->
<form method="get" class="row g-2 mb-3">
    <!-- Inputs de b√∫squeda y filtros -->
</form>

<div class="mb-3">
    {% if user.is_staff %}
        <a href="{% url 'productos:producto_create' %}" class="btn btn-primary shadow-sm">
            ‚ûï Nuevo producto
        </a>
    {% endif %}
</div>

<!-- Tabla de productos -->
<table class="table table-striped table-hover shadow-sm align-middle">
    <thead class="table-dark text-center">
        <tr>
            <th>Portada</th>
            <th>Nombre</th>
            <th>Categor√≠a</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for producto in productos %}
        <tr>
            <!-- Portada -->
            <td class="text-center">
                {% if producto.portada %}
                    <a href="{% url 'productos:producto_detail' producto.id %}">
                        <img src="{{ producto.portada.url }}" alt="{{ producto.nombre }}" width="60" class="rounded shadow-sm">
                    </a>
                {% else %}
                    <span class="text-muted">Sin imagen</span>
                {% endif %}
            </td>

            <!-- Nombre -->
            <td>
                <a href="{% url 'productos:producto_detail' producto.id %}" class="fw-bold text-decoration-none">
                    {{ producto.nombre }}
                </a>
            </td>

            <!-- Categor√≠a -->
            <td>
                {% if producto.categoria %}
                    üìÇ {{ producto.categoria.nombre }}
                {% else %}
                    <span class="text-muted">Sin categor√≠a</span>
                {% endif %}
            </td>

            <!-- Precio -->
            <td><strong>${{ producto.precio|floatformat:2 }}</strong></td>

            <!-- Stock -->
            <td>
                {% if producto.stock == 0 %}
                    <span class="badge bg-danger">Agotado</span>
                {% elif producto.stock < 5 %}
                    <span class="badge bg-warning">Stock bajo ({{ producto.stock }})</span>
                {% else %}
                    <span class="badge bg-success">Disponible ({{ producto.stock }})</span>
                {% endif %}
            </td>

            <!-- Acciones -->
            <td class="text-center">
                <a href="{% url 'productos:producto_detail' producto.id %}" class="btn btn-sm btn-info">
                    üîç Ver
                </a>
                {% if user.is_staff %}
                    <a href="{% url 'productos:producto_update' producto.id %}" class="btn btn-sm btn-warning">
                        ‚úèÔ∏è Editar
                    </a>
                    <a href="{% url 'productos:producto_delete' producto.id %}" class="btn btn-sm btn-danger">
                        üóëÔ∏è Eliminar
                    </a>
                {% else %}
                    {% if producto.stock > 0 %}
                        <form method="post" action="{% url 'carrito:carrito_add' producto.id %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-primary">
                                üõí Agregar
                            </button>
                        </form>
                    {% else %}
                        <span class="text-muted">No disponible</span>
                    {% endif %}
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center text-muted">No se encontraron productos.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Paginaci√≥n -->
{% if is_paginated %}
<nav aria-label="Paginaci√≥n de productos">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a>
            </li>
        {% endif %}
        <li class="page-item active">
            <span class="page-link">{{ page_obj.number }}</span>
        </li>
        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">Siguiente</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock %}
