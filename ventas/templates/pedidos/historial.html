{% extends "ventas/base_ventas.html" %}
{% load static %}

{% block title %}Historial de pedidos{% endblock %}

{% block content %}
  <h2 class="mb-4">üìú Historial de pedidos</h2>

  {% if pedidos %}
    <p class="text-muted">Total de pedidos: {{ total_pedidos }}</p>

    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark text-center">
        <tr>
          <th>#</th>
          <th>Producto</th>
          <th>M√©todo de pago</th>
          <th>Precio unitario</th>
          <th>Cantidad</th>
          <th>Total</th>
          <th>Estado</th>
          <th>Fecha pedido</th>
          <th>Fecha entrega</th>
        </tr>
      </thead>
      <tbody>
        {% for pedido in pedidos %}
          <tr>
            <td>{{ pedido.id }}</td>
            <td class="fw-bold">{{ pedido.producto.nombre }}</td>
            <td>
              <span class="badge bg-secondary">
                {{ pedido.metodo_pago|default:"-" }}
              </span>
            </td>
            <td>
              <span class="badge bg-success">
                ${{ pedido.precio_unitario|floatformat:2 }}
              </span>
            </td>
            <td>{{ pedido.cantidad }}</td>
            <td>
              <span class="badge bg-info">
                ${{ pedido.total|floatformat:2 }}
              </span>
            </td>
            <td>
              {% if pedido.estado == 'pendiente' %}
                <span class="badge bg-warning text-dark">Pendiente</span>
              {% elif pedido.estado == 'enviado' %}
                <span class="badge bg-info text-dark">Enviado</span>
              {% elif pedido.estado == 'entregado' %}
                <span class="badge bg-success">Entregado</span>
              {% else %}
                <span class="badge bg-secondary">{{ pedido.get_estado_display }}</span>
              {% endif %}
            </td>
            <td>{{ pedido.fecha_pedido|date:"d/m/Y H:i" }}</td>
            <td>{{ pedido.fecha_entrega|date:"d/m/Y" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Paginaci√≥n -->
    {% if pedidos.has_other_pages %}
    <nav aria-label="Paginaci√≥n historial" class="mt-4">
      <ul class="pagination justify-content-center">
        {% if pedidos.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ pedidos.previous_page_number }}">‚¨ÖÔ∏è Anterior</a>
          </li>
        {% endif %}
        <li class="page-item active">
          <span class="page-link">
            P√°gina {{ pedidos.number }} de {{ pedidos.paginator.num_pages }}
          </span>
        </li>
        {% if pedidos.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ pedidos.next_page_number }}">Siguiente ‚û°Ô∏è</a>
          </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}

  {% else %}
    <div class="p-5 mb-4 bg-light rounded-3 text-center shadow-sm">
      <h4 class="text-muted">üö´ No ten√©s pedidos por ahora</h4>
      <p class="text-secondary">Cuando compres, ver√°s ac√° el detalle con m√©todo de pago.</p>
      <a href="{% url 'carrito:carrito_detail' %}" class="btn btn-primary mt-3">Ir al carrito</a>
    </div>
  {% endif %}
{% endblock %}
